# OfflineAssemblerApp - Обновление функционала и интерфейса

## Текущее состояние проекта

Приложение на Python с использованием `tkinter` и `ttk` для сборки заказов. Была начата реализация темной темы и футуристического дизайна. `excel_processor.py` отвечает за чтение и запись Excel-файлов.

**Идентифицированные проблемы/задачи:**

1.  **Структура входного Excel-файла:** Предоставлен новый пример файла (`озон омск 233 сорт.xlsx`). Необходимо адаптировать `excel_processor.py` для корректного чтения данных, включая новые поля "Ячейка" и "Штрихкод", которые находятся на 4-й строке (индекс 3).
2.  **Обновление интерфейса `gui_app.py`:** Требуются значительные изменения для улучшения пользовательского опыта и внешнего вида.
3.  **Обновление выходной таблицы Excel (`excel_processor.py`):** Изменение структуры итогового файла и формата расхождений.

## Детали запрошенных изменений

### Интерфейс (`gui_app.py`)

1.  **Видимость кнопок:** Во время активной сборки кнопки "Открыть Excel" и "Загрузить сборку" должны исчезать.
2.  **Отображение информации о товаре:** Информация о текущем товаре должна быть переформатирована:
    *   Сверху: Наименование товара (текст без штрихкода в конце).
    *   Посередине: Ячейка (местоположение товара).
    *   Снизу: Последние 4 цифры штрихкода, за которыми следует количество.
3.  **Счетчик позиций:** Переместить счетчик "Позиция X из Y" в самую верхнюю часть интерфейса.
4.  **Кнопки действий:**
    *   Кнопка "Собрано" должна быть крупнее.
    *   Остальные кнопки действий ("Нету", "Изменить кол-во", "След. коробка") должны быть доступны через выпадающее меню (например, по нажатию кнопки "Действия"), чтобы избежать случайных нажатий.
5.  **Замещение кнопок:** Во время сборки кнопки "Обзор и правка" и "Сохранить прогресс" должны занимать место кнопок открытия/загрузки файла.
6.  **Закругленные кнопки:** По возможности, применить закругленные углы к кнопкам.

### Выходная таблица Excel (`excel_processor.py`)

1.  **Формат собранных данных:** В итоговой таблице должны присутствовать столбцы: "Количество", "Артикул", "Штрихкод" (без "Наименования товара").
2.  **Расхождения:** Заголовок "Расхождения" оставить, но в списке расхождений вместо наименований товаров использовать только их штрихкоды.

## План действий

### Фаза 1: Обновление `excel_processor.py`

1.  **Корректное чтение Excel-файла:**
    *   Изменить метод `_load_dataframe` в классе `ExcelProcessor` для чтения файла, указав `header=3` (строка 4, если считать с 0).
    *   Обновить метод `_parse_orders` в `ExcelProcessor` для поиска заголовков "Ячейка" и "Штрихкод".
    *   Извлечь значения "Местоположение" и "Штрихкод" для каждого товара и добавить их в словарь `orders`.
2.  **Обновление класса `ExcelWriter`:**
    *   Модифицировать метод `generate_final_file`, чтобы итоговый Excel-файл содержал "Кол-во", "Артикул", "Штрихкод" (вместо "Название").
    *   В разделе "Расхождения" использовать только штрихкоды вместо наименований товаров.

### Фаза 2: Обновление `gui_app.py`

1.  **Управление видимостью кнопок:**
    *   Реализовать логику скрытия `load_button` и `load_session_button` при начале сборки.
    *   Показывать `review_button` и `save_session_button` на их месте.
2.  **Переработка `display_current_item`:**
    *   Обновить форматирование `info_label` и `progress_label`.
    *   Реализовать обрезку штрихкода из наименования товара и извлечение последних 4 цифр штрихкода для отображения.
    *   Убедиться, что `self.assembly_items` содержит поля `location` и `barcode`.
3.  **Перемещение счетчика позиций:** Переместить `progress_label` в верхнюю часть интерфейса.
4.  **Реорганизация кнопок действий:**
    *   Увеличить размер `collect_button`.
    *   Создать новую кнопку "Действия", по нажатию на которую будет появляться выпадающее меню с кнопками "Нету", "Изменить кол-во", "След. коробка".
5.  **Закругленные кнопки:** Изучить возможности `ttk.Style` для создания закругленных кнопок. Если стандартные средства `ttk` не позволяют достичь желаемого, предложить альтернативное решение или отметить ограничение.

## Дальнейшие действия

Начать с Фазы 1, пункт 1: внесение изменений в `excel_processor.py` для корректного чтения Excel-файла с новыми столбцами "Ячейка" и "Штрихкод".